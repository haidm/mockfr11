<?php $firstMenuItem = Mage::getModel('hungbd_megamenu/menuitem')->getCollection()->addFilter('level', '0'); ?>
<?php $maxLevel = (int)Mage::getStoreConfig('general/hungbd_megamenu/level'); ?>
<?php $listMenuItem = Mage::getModel('hungbd_megamenu/menuitem')->getCollection(); ?>
<nav class="main-nav" role="navigation">
    <ul id="main-menu" class="sm sm-blue">
        <?php foreach ($firstMenuItem as $key => $item): ?>
            <li>
                <a href="<?php echo $item->link; ?>"><?php echo $item->name; ?></a>
                <?php $this->getChildItem($item, $maxLevel, $listMenuItem); ?>
            </li>
        <?php endforeach; ?>
    </ul>
</nav>

<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $(function () {
            $('#main-menu').smartmenus({
                subMenusSubOffsetX: 1,
                subMenusSubOffsetY: -8
            });
        });
        $(function () {
            var $mainMenuState = $('#main-menu-state');
            if ($mainMenuState.length) {
                // animate mobile menu
                $mainMenuState.change(function (e) {
                    var $menu = $('#main-menu');
                    if (this.checked) {
                        $menu.hide().slideDown(250, function () {
                            $menu.css('display', '');
                        });
                    } else {
                        $menu.show().slideUp(250, function () {
                            $menu.css('display', '');
                        });
                    }
                });
                // hide mobile menu beforeunload
                $(window).bind('beforeunload unload', function () {
                    if ($mainMenuState[0].checked) {
                        $mainMenuState[0].click();
                    }
                });
            }
        });
    });

</script>
